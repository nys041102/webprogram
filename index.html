<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>나의 포트폴리오</title>
  <link rel="stylesheet" href="../css/my.css">
</head>
<body>

  <!-- 헤더 -->
  <header class="header">
    <div class="inner">
      <h1 class="logo">NA YOUNGSEO</h1>
      <nav class="nav">
        <ul>
          <li><a href="#about">내 소개</a></li>
          <li><a href="#portfolio">포트폴리오</a></li>
          <li><a href="#comments">댓글</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- 소개 섹션 -->
  <section id="about" class="section about">
    <div class="inner">
      <h2 class="sec-title">내 소개</h2>
      <p class="desc">
        안녕하세요! 저는 <strong>나영서</strong>입니다.<br>
        웹 프로그래밍을 배우고 있으며, 이 페이지는 제가 제작한 포트폴리오 사이트입니다 😊<br><br>
        현재 군산대학교에 재학 중이며 HTML, CSS, JavaScript를 활용한 다양한 웹 프로젝트를 진행하고 있어요.
      </p>
    </div>
  </section>

  <!-- 포트폴리오 섹션 -->
  <section id="portfolio" class="section portfolio">
    <div class="inner">
      <h2 class="sec-title">포트폴리오</h2>
      <p class="desc">제가 만든 학과 소개 페이지입니다! 👇</p>

      <a href="https://nys.r-e.kr/my.html" target="_blank" class="portfolio-link">
        학과 소개 페이지 보러가기
      </a>
    </div>
  </section>

  <!-- 댓글 섹션 -->
  <section id="comments" class="section comments">
    <div class="inner">
      <h2 class="sec-title">댓글</h2>

      <form id="commentForm" class="comment-form">
        <label>이름</label>
        <input type="text" id="username" required>

        <label>댓글</label>
        <textarea id="comment" rows="4" required></textarea>

        <button type="submit">댓글 남기기</button>
      </form>

      <div id="commentList" class="comment-list"></div>
    </div>
  </section>

  <script>
    const form = document.getElementById("commentForm");
    const commentList = document.getElementById("commentList");

    // ⭐ 댓글 목록 불러오기
    function loadComments() {
      fetch("http://localhost:3000/comment")
        .then(res => res.json())
        .then(list => {
          commentList.innerHTML = "";

          list.forEach(item => {
            commentList.innerHTML += `
              <div class="comment-box">
                <strong>${item.name}</strong>
                <p>${item.message}</p>
                <span class="time">${item.created_at.slice(0, 16)}</span>
              </div>
            `;
          });
        })
        .catch(err => console.error("댓글 불러오기 오류:", err));
    }

    // ⭐ 댓글 저장
    form.addEventListener("submit", function(event) {
      event.preventDefault();
      
      const name = document.getElementById("username").value;
      const message = document.getElementById("comment").value;

      fetch("http://localhost:3000/comment", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ name, message })
      })
      .then(res => res.json())
      .then(result => {
        if (result.success) {
          loadComments();  // 저장 후 자동 새로고침
          form.reset();
        } else {
          alert("댓글 저장 실패: " + result.error);
        }
      })
      .catch(err => console.error("댓글 저장 오류:", err));
    });

    fetch("http://localhost:3000/log", { //댓글작성
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ page: "index", action: "visit" })
  });
    // 페이지 열리면 자동으로 댓글 목록 불러오기
    loadComments();
  </script>

</body>
</html>
